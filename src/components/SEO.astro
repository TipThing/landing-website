---
/**
 * SEO Component for Astro
 * Comprehensive SEO meta tags component following 2025 best practices
 *
 * Features:
 * - Basic meta tags (title, description, keywords)
 * - Open Graph tags for social sharing
 * - Twitter Card tags
 * - Canonical URLs
 * - JSON-LD structured data
 * - Optimized for Core Web Vitals
 */

export interface Props {
  // Basic Meta Tags
  title?: string;
  description?: string;
  keywords?: string[];

  // Canonical URL
  canonical?: string;

  // Open Graph Tags
  openGraph?: {
    title?: string;
    description?: string;
    url?: string;
    type?: 'website' | 'article' | 'product' | 'profile';
    image?: {
      url: string;
      width?: number;
      height?: number;
      alt?: string;
      type?: string;
    };
    locale?: string;
    siteName?: string;
    article?: {
      publishedTime?: string;
      modifiedTime?: string;
      author?: string;
      section?: string;
      tags?: string[];
    };
  };

  // Twitter Card Tags
  twitter?: {
    card?: 'summary' | 'summary_large_image' | 'app' | 'player';
    site?: string;
    creator?: string;
    title?: string;
    description?: string;
    image?: string;
    imageAlt?: string;
  };

  // Additional Meta Tags
  robots?: string;
  googlebot?: string;
  author?: string;
  language?: string;

  // JSON-LD Structured Data
  jsonLd?: object | object[];

  // Favicon and Icons
  favicon?: string;
  appleTouchIcon?: string;
}

const {
  title = 'TipThing - Software, Solved.',
  description = 'We engineer bespoke cloud architectures and deploy powerful pre-built tools. No fluff. Just precision software that moves your business forward.',
  keywords = ['custom software development', 'cloud architecture', 'bespoke engineering', 'software consultancy'],
  canonical,
  openGraph,
  twitter,
  robots = 'index, follow',
  googlebot,
  author = 'TipThing',
  language = 'en',
  jsonLd,
  favicon = '/favicon.svg',
  appleTouchIcon,
} = Astro.props;

// Construct canonical URL using Astro's URL if not provided
const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site).toString();

// Default Open Graph values
const ogDefaults = {
  title: title,
  description: description,
  url: canonicalURL,
  type: 'website' as const,
  locale: 'en_US',
  siteName: 'Tipthing',
};

const og = { ...ogDefaults, ...openGraph };

// Default Twitter Card values
const twitterDefaults = {
  card: 'summary_large_image' as const,
  title: title,
  description: description,
};

const tw = { ...twitterDefaults, ...twitter };

// Convert keywords array to comma-separated string
const keywordsString = keywords.join(', ');

// Prepare JSON-LD structured data
const jsonLdArray = Array.isArray(jsonLd) ? jsonLd : jsonLd ? [jsonLd] : [];
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
{keywords.length > 0 && <meta name="keywords" content={keywordsString} />}
<meta name="author" content={author} />
<meta name="language" content={language} />

<!-- Robots -->
<meta name="robots" content={robots} />
{googlebot && <meta name="googlebot" content={googlebot} />}

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={og.type} />
<meta property="og:url" content={og.url} />
<meta property="og:title" content={og.title} />
<meta property="og:description" content={og.description} />
{og.siteName && <meta property="og:site_name" content={og.siteName} />}
{og.locale && <meta property="og:locale" content={og.locale} />}

{og.image && (
  <>
    <meta property="og:image" content={og.image.url} />
    {og.image.width && <meta property="og:image:width" content={og.image.width.toString()} />}
    {og.image.height && <meta property="og:image:height" content={og.image.height.toString()} />}
    {og.image.alt && <meta property="og:image:alt" content={og.image.alt} />}
    {og.image.type && <meta property="og:image:type" content={og.image.type} />}
  </>
)}

{og.article && (
  <>
    {og.article.publishedTime && <meta property="article:published_time" content={og.article.publishedTime} />}
    {og.article.modifiedTime && <meta property="article:modified_time" content={og.article.modifiedTime} />}
    {og.article.author && <meta property="article:author" content={og.article.author} />}
    {og.article.section && <meta property="article:section" content={og.article.section} />}
    {og.article.tags && og.article.tags.map((tag) => (
      <meta property="article:tag" content={tag} />
    ))}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content={tw.card} />
{tw.site && <meta name="twitter:site" content={tw.site} />}
{tw.creator && <meta name="twitter:creator" content={tw.creator} />}
<meta name="twitter:title" content={tw.title} />
<meta name="twitter:description" content={tw.description} />
{tw.image && <meta name="twitter:image" content={tw.image} />}
{tw.imageAlt && <meta name="twitter:image:alt" content={tw.imageAlt} />}

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href={favicon} />

<!-- Sitemap -->
<link rel="sitemap" href="/sitemap-index.xml" />
{appleTouchIcon && <link rel="apple-touch-icon" href={appleTouchIcon} />}

<!-- Theme Color for mobile browsers -->
<meta name="theme-color" content="#09090b" />

<!-- JSON-LD Structured Data -->
{jsonLdArray.map((data) => (
  <script type="application/ld+json" set:html={JSON.stringify(data)} />
))}
