---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import SEO from '../components/SEO.astro';
import { seoConfig } from '../lib/seo-config';
import { getTipthingDefaultSchema } from '../lib/seo-helpers';

export interface Props {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  noindex?: boolean;
  pageType?: 'website' | 'article' | 'product' | 'profile';
}

const {
  title,
  description,
  keywords,
  image,
  noindex = false,
  pageType = 'website',
} = Astro.props;

// Get default structured data
const baseUrl = (Astro.site?.toString() || seoConfig.siteUrl).replace(/\/$/, '');
const defaultJsonLd = getTipthingDefaultSchema(baseUrl);

// Prepare Open Graph image
const ogImage = image
  ? {
      url: image.startsWith('http') ? image : `${baseUrl}${image}`,
      width: seoConfig.defaultImage.width,
      height: seoConfig.defaultImage.height,
      alt: title || seoConfig.defaultTitle,
    }
  : {
      url: `${baseUrl}${seoConfig.defaultImage.url}`,
      width: seoConfig.defaultImage.width,
      height: seoConfig.defaultImage.height,
      alt: seoConfig.defaultImage.alt,
    };
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		<meta name="color-scheme" content="dark" />

		<!-- View Transitions for seamless page navigation -->
		<ViewTransitions />

		<!-- Font optimization: Use system fonts for instant render -->
		<style>
			/* Critical CSS: Font fallback chain */
			:root {
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
					'Helvetica Neue', Arial, sans-serif;
				font-feature-settings: 'kern' 1;
				text-rendering: optimizeLegibility;
				-webkit-font-smoothing: antialiased;
				-moz-osx-font-smoothing: grayscale;
			}
		</style>

		<SEO
			title={title}
			description={description}
			keywords={keywords}
			robots={noindex ? seoConfig.robots.noindex : seoConfig.robots.default}
			openGraph={{
				type: pageType,
				image: ogImage,
				siteName: seoConfig.siteName,
				locale: seoConfig.locale,
			}}
			twitter={{
				card: seoConfig.twitter.card,
				site: seoConfig.twitter.handle,
				image: ogImage.url,
				imageAlt: ogImage.alt,
			}}
			jsonLd={defaultJsonLd}
		/>
	</head>
	<body>
		<slot />
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
